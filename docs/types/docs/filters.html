<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Filters - go-msx</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../modules.html"><strong aria-hidden="true">1.1.</strong> Module Overview</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Cross-Cutting Concerns</li><li class="chapter-item expanded "><a href="../../log/index.html"><strong aria-hidden="true">2.</strong> Logging</a></li><li class="chapter-item expanded "><a href="../../types/docs/errors.html"><strong aria-hidden="true">3.</strong> Errors</a></li><li class="chapter-item expanded "><a href="../../config/index.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../config/consulprovider/index.html"><strong aria-hidden="true">4.1.</strong> Consul Configuration Provider</a></li></ol></li><li class="chapter-item expanded "><a href="../../app/index.html"><strong aria-hidden="true">5.</strong> Lifecycle</a></li><li class="chapter-item expanded "><a href="../../app/context.html"><strong aria-hidden="true">6.</strong> Dependencies</a></li><li class="chapter-item expanded "><a href="../../stats/index.html"><strong aria-hidden="true">7.</strong> Stats</a></li><li class="chapter-item expanded "><a href="../../trace/index.html"><strong aria-hidden="true">8.</strong> Tracing</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Application Patterns</li><li class="chapter-item expanded "><a href="../../types/docs/operations.html"><strong aria-hidden="true">9.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../types/docs/middleware.html"><strong aria-hidden="true">9.1.</strong> Middleware</a></li><li class="chapter-item expanded "><a href="../../types/docs/decorators.html"><strong aria-hidden="true">9.2.</strong> Decorators</a></li><li class="chapter-item expanded "><a href="../../types/docs/filters.html" class="active"><strong aria-hidden="true">9.3.</strong> Filters</a></li><li class="chapter-item expanded "><a href="../../trace/docs/operations.html"><strong aria-hidden="true">9.4.</strong> Traced Operations</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.5.</strong> Handlers</div></li></ol></li><li class="chapter-item expanded "><a href="../../ops/docs/ports.html"><strong aria-hidden="true">10.</strong> Ports</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ops/docs/input-ports.html"><strong aria-hidden="true">10.1.</strong> Input Ports</a></li><li class="chapter-item expanded "><a href="../../ops/docs/output-ports.html"><strong aria-hidden="true">10.2.</strong> Output Ports</a></li><li class="chapter-item expanded "><a href="../../ops/docs/validation.html"><strong aria-hidden="true">10.3.</strong> Validation</a></li></ol></li><li class="chapter-item expanded "><a href="../../types/docs/services.html"><strong aria-hidden="true">11.</strong> Services</a></li><li class="chapter-item expanded "><a href="../../webservice/controller.html"><strong aria-hidden="true">12.</strong> ðŸ’€ REST Controller Mk I </a></li><li class="chapter-item expanded "><a href="../../ops/restops/docs/controller.html"><strong aria-hidden="true">13.</strong> ðŸŽ‰ REST Controller Mk II </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ops/restops/docs/input-ports.html"><strong aria-hidden="true">13.1.</strong> REST Input Ports</a></li><li class="chapter-item expanded "><a href="../../ops/restops/docs/output-ports.html"><strong aria-hidden="true">13.2.</strong> REST Output Ports</a></li><li class="chapter-item expanded "><a href="../../ops/restops/docs/middleware.html"><strong aria-hidden="true">13.3.</strong> Middleware</a></li></ol></li><li class="chapter-item expanded "><a href="../../sqldb/repository.html"><strong aria-hidden="true">14.</strong> ðŸ’€ CRUD Repository </a></li><li class="chapter-item expanded "><a href="../../sqldb/docs/new_repositories_typed.html"><strong aria-hidden="true">15.</strong> ðŸŽ‰Typed Repository</a></li><li class="chapter-item expanded "><a href="../../sqldb/docs/new_repositories_goqu.html"><strong aria-hidden="true">16.</strong> ðŸŽ‰Goqu Repository</a></li><li class="chapter-item expanded "><a href="../../sqldb/docs/new_repositories_sql.html"><strong aria-hidden="true">17.</strong> ðŸŽ‰SQL Repository</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Migration</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> Integration</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../integration/docs/openapi.html"><strong aria-hidden="true">19.1.</strong> ðŸŽ‰ OpenAPI Client </a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.</strong> Streaming</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ops/streamops/index.html"><strong aria-hidden="true">20.1.</strong> ðŸŽ‰ Stream Operations </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ops/streamops/ports.html"><strong aria-hidden="true">20.1.1.</strong> Ports</a></li><li class="chapter-item expanded "><a href="../../ops/streamops/publishers.html"><strong aria-hidden="true">20.1.2.</strong> Publishers</a></li><li class="chapter-item expanded "><a href="../../ops/streamops/subscribers.html"><strong aria-hidden="true">20.1.3.</strong> Subscribers</a></li><li class="chapter-item expanded "><a href="../../schema/asyncapi/index.html"><strong aria-hidden="true">20.1.4.</strong> AsyncApi</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.2.</strong> Stream Providers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">20.2.1.</strong> Kafka</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.2.2.</strong> SQL</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.2.3.</strong> GoChannel</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.2.4.</strong> Redis</div></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Utilities</li><li class="chapter-item expanded "><div><strong aria-hidden="true">21.</strong> Audit Events</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">22.</strong> Auditable Models</div></li><li class="chapter-item expanded "><a href="../../cache/lru/index.html"><strong aria-hidden="true">23.</strong> Cache</a></li><li class="chapter-item expanded "><a href="../../certificate/index.html"><strong aria-hidden="true">24.</strong> Certificates and TLS</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">25.</strong> Executing Commands</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">26.</strong> Health Checks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">27.</strong> Http Client</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">28.</strong> Leader Election</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">29.</strong> Pagination</div></li><li class="chapter-item expanded "><a href="../../resource/index.html"><strong aria-hidden="true">30.</strong> Resources</a></li><li class="chapter-item expanded "><a href="../../retry/index.html"><strong aria-hidden="true">31.</strong> Retry</a></li><li class="chapter-item expanded "><a href="../../sanitize/index.html"><strong aria-hidden="true">32.</strong> Sanitization</a></li><li class="chapter-item expanded "><a href="../../scheduled/index.html"><strong aria-hidden="true">33.</strong> Scheduled Tasks</a></li><li class="chapter-item expanded "><a href="../../transit/index.html"><strong aria-hidden="true">34.</strong> Transit Encryption</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">35.</strong> Validation</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Code Generation (skel)</li><li class="chapter-item expanded "><a href="../../skel/index.html"><strong aria-hidden="true">36.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../skel/docs/installation.html"><strong aria-hidden="true">37.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../../skel/docs/usage.html"><strong aria-hidden="true">38.</strong> Usage</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">39.</strong> Projects</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../skel/docs/projects-generic.html"><strong aria-hidden="true">39.1.</strong> Generic Microservice</a></li><li class="chapter-item expanded "><a href="../../skel/docs/projects-beats.html"><strong aria-hidden="true">39.2.</strong> Probes (Beats)</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">39.3.</strong> Service Pack Microservice</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">39.4.</strong> Service Pack UI</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">40.</strong> Continuous Integration</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">41.</strong> Web Services</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">41.1.</strong> Domains</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">41.2.</strong> OpenAPI</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">42.</strong> Stream Services</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../skel/asyncapi/channels.html"><strong aria-hidden="true">42.1.</strong> Channels</a></li><li class="chapter-item expanded "><a href="../../skel/asyncapi/spec.html"><strong aria-hidden="true">42.2.</strong> AsyncAPI</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">43.</strong> Deployment</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">43.1.</strong> Kubernetes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../skel/docs/skaffold.html"><strong aria-hidden="true">43.1.1.</strong> Skaffold</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Builds</li><li class="chapter-item expanded "><div><strong aria-hidden="true">44.</strong> Introduction</div></li><li class="chapter-item expanded "><a href="../../build/docs/usage-make.html"><strong aria-hidden="true">45.</strong> Makefile Usage</a></li><li class="chapter-item expanded "><a href="../../build/docs/usage-build.html"><strong aria-hidden="true">46.</strong> Build Usage</a></li><li class="chapter-item expanded "><a href="../../build/docs/config.html"><strong aria-hidden="true">47.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../build/docs/targets.html"><strong aria-hidden="true">48.</strong> Build Targets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../build/docs/targets-project.html"><strong aria-hidden="true">48.1.</strong> Project Maintenance</a></li><li class="chapter-item expanded "><a href="../../build/docs/targets-development.html"><strong aria-hidden="true">48.2.</strong> Development</a></li><li class="chapter-item expanded "><a href="../../build/docs/targets-artifacts.html"><strong aria-hidden="true">48.3.</strong> Artifacts</a></li><li class="chapter-item expanded "><a href="../../build/docs/targets-verification.html"><strong aria-hidden="true">48.4.</strong> Verification</a></li><li class="chapter-item expanded "><a href="../../build/docs/targets-publishing.html"><strong aria-hidden="true">48.5.</strong> Publishing</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Continuous Integration</li><li class="chapter-item expanded "><a href="../../checks/index.html"><strong aria-hidden="true">49.</strong> Checks ðŸŽ‰</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">50.</strong> Jenkins</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">For Developers of go-msx</li><li class="chapter-item expanded "><div><strong aria-hidden="true">51.</strong> Introduction</div></li><li class="chapter-item expanded "><a href="../../CONTRIBUTING.html"><strong aria-hidden="true">52.</strong> Contributing</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">53.</strong> skel: Code Generation</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../skel/docs/sequence.html"><strong aria-hidden="true">53.1.</strong> Execution Sequence</a></li><li class="chapter-item expanded "><a href="../../skel/docs/templating.html"><strong aria-hidden="true">53.2.</strong> Making templates</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">go-msx</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="filters"><a class="header" href="#filters">Filters</a></h1>
<p>When reusing multiple Middleware types for a given Operation, it may be important that some 
middleware instances are consistently applied before others.</p>
<p>For example, our TokenFilter is applied to our HTTP pipeline to extract the token from Request
and inject it into the Context.  This must occur <em>before</em> our AuthenticationFilter checks the
token in the Context and verifies the user is properly authenticated.   Since we can swap in 
CertificateFilter for TokenFilter (when using Certificate Authentication), it important that 
the Middleware not be coupled, and always be applied in the correct order.</p>
<p>Decorators do not directly allow application in middleware-specified order.  This presents many
problems when using factories to generate higher level Operation abstractions such as Endpoints
and Message Subscribers.  These factories do not need to know about the variety or application 
order of these Decorators, especially when they are mixed with framework-specified Middleware.</p>
<p>To enable this scenario, go-msx offers Filters.  Filters allow you to ensure the correct
ordering of Middleware when passed along from other components without requiring tight
coupling or specialization.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>To apply a filter to an Operation, use the <code>WithFilter</code> method:</p>
<pre><code class="language-go">err := types.NewOperation(myAction).
	WithFilter(NewLoggingFilter(logger)).
	Run(ctx)
</code></pre>
<h3 id="order"><a class="header" href="#order">Order</a></h3>
<p>Filter Order can be though of as priority: a higher number means it will be applied earlier
to the target Action.</p>
<p>For example, if Filter A has an order of <code>0</code> and Filter B has an order of <code>100</code>, then
Filter B will be applied first (executed second inbound, first outbound), and Filter A will
be applied second (executed first inbound, second outbound).</p>
<p>Note that when combining Operation instances using the <code>Operation.Run</code> method, filters are
only ordered relative to the other Filters and Decorators on the Operation to which it was directly
applied.</p>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<p>A Filter is envisioned as a simple wrapper around a Decorator which also
provides a method to inspect the order that it should be applied:</p>
<pre><code class="language-go">// ActionFilter is an ordered Decorator
type ActionFilter interface {
  Order() int
  Decorator() ActionFuncDecorator
}
</code></pre>
<p>When authoring a Filter, any type that implements <code>ActionFilter</code> can be used.
You can even transform a Decorator into a Filter using a simple factory:</p>
<pre><code class="language-go">recoveryDecorator := NewRecoveryDecorator()
filter := types.NewOrderedDecorator(100, recoveryDecorator)
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../types/docs/decorators.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../trace/docs/operations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../types/docs/decorators.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../trace/docs/operations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../book/mermaid.min.js"></script>
        <script type="text/javascript" src="../../book/mermaid-init.js"></script>
    </body>
</html>
